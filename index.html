<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíä Supplement Tracker | Maratona Londres 2026</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: #0f172a; color: #f1f5f9; min-height: 100vh; }
        input, select { font-family: 'Inter', sans-serif; }
        .tab-active { background: #3b82f6 !important; color: white !important; }
        .timing-tag {
            display: inline-block;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 6px;
            font-weight: 500;
        }
        .timing-jejum { background: #fef3c7; color: #92400e; }
        .timing-refeicao { background: #d1fae5; color: #065f46; }
        .timing-treino { background: #fce7f3; color: #9d174d; }
        .timing-dormir { background: #e0e7ff; color: #3730a3; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ============ DATAS CR√çTICAS ============
        const RACE_DATE = new Date("2026-04-26");
        const PLAN_START = new Date("2025-12-01");

        // ============ DEFAULT DATA ============
        const DEFAULT_SUPPLEMENTS = {
            manha: {
                name: "Manh√£",
                time: "06:30",
                emoji: "üåÖ",
                color: "#3b82f6",
                bgColor: "rgba(59, 130, 246, 0.15)",
                items: [
                    { id: "tongkat", name: "Tongkat Ali", dose: "400mg", caps: 2, timing: "jejum", notes: "Em jejum (20min antes p.almo√ßo)" },
                    { id: "boro", name: "Boro", dose: "6mg", caps: 2, timing: "refeicao", notes: "Com pequeno-almo√ßo" },
                    { id: "d3k2", name: "Vit D3+K2", dose: "5000UI", caps: 1, timing: "refeicao", notes: "Com p.almo√ßo (precisa gordura)" },
                    { id: "magthreo", name: "Mg L-Treonato", dose: "2000mg", caps: 3, timing: "refeicao", notes: "Com pequeno-almo√ßo" },
                    { id: "metilfolato", name: "Metilfolato", dose: "400mcg", caps: 1, timing: "refeicao", notes: "Com pequeno-almo√ßo" },
                    { id: "ashwa_am", name: "Ashwagandha", dose: "300mg", caps: 1, timing: "refeicao", notes: "Com pequeno-almo√ßo" },
                    { id: "creatina", name: "Creatina", dose: "5g", caps: null, timing: "refeicao", notes: "Com p.almo√ßo (com hidratos)" }
                ]
            },
            pretreino: {
                name: "Pr√©-Treino",
                time: "Vari√°vel",
                emoji: "‚ö°",
                color: "#f59e0b",
                bgColor: "rgba(245, 158, 11, 0.15)",
                items: [
                    { id: "colagenio", name: "Colag√©nio + Vit C", dose: "15g + 500mg", caps: null, days: [0, 1, 3, 4, 5], timing: "treino", notes: "45-60min ANTES do treino" },
                    { id: "beterraba", name: "Shot Beterraba", dose: "400mg NO‚ÇÉ", caps: 1, days: [0, 3], timing: "treino", notes: "2-3h ANTES do treino" }
                ]
            },
            almoco: {
                name: "Almo√ßo",
                time: "13:30",
                emoji: "üçΩÔ∏è",
                color: "#10b981",
                bgColor: "rgba(16, 185, 129, 0.15)",
                items: [
                    { id: "omega_pm1", name: "√ìmega-3", dose: "1200mg", caps: 4, timing: "refeicao", notes: "Durante o almo√ßo" }
                ]
            },
            tarde: {
                name: "Tarde",
                time: "16:00",
                emoji: "üçí",
                color: "#ec4899",
                bgColor: "rgba(236, 72, 153, 0.15)",
                items: [
                    { id: "cereja_pm1", name: "Cereja √Åcida", dose: "30mL", caps: null, taperOnly: true, timing: "refeicao", notes: "Entre refei√ß√µes" }
                ]
            },
            postreino: {
                name: "P√≥s-Treino",
                time: "Ap√≥s exerc√≠cio",
                emoji: "üí™",
                color: "#8b5cf6",
                bgColor: "rgba(139, 92, 246, 0.15)",
                items: [
                    { id: "whey", name: "Whey Isolada", dose: "25-30g", caps: null, days: [0, 1, 2, 3, 4, 5], timing: "treino", notes: "At√© 30min AP√ìS treino" }
                ]
            },
            noite: {
                name: "Noite",
                time: "21:00 - 22:00",
                emoji: "üåô",
                color: "#6366f1",
                bgColor: "rgba(99, 102, 241, 0.15)",
                items: [
                    { id: "omega_pm2", name: "√ìmega-3", dose: "1200mg", caps: 4, timing: "refeicao", notes: "Durante o jantar" },
                    { id: "cereja_pm2", name: "Cereja √Åcida", dose: "30mL", caps: null, taperOnly: true, timing: "dormir", notes: "Antes de dormir (melatonina)" },
                    { id: "magglic", name: "Mg Glicinato", dose: "300mg", caps: 1, timing: "dormir", notes: "Antes de dormir" },
                    { id: "ashwa_pm", name: "Ashwagandha", dose: "300mg", caps: 1, timing: "dormir", notes: "Antes de dormir (cortisol)" }
                ]
            }
        };

        const TIMING_STYLES = {
            jejum: { class: "timing-jejum", label: "Jejum" },
            refeicao: { class: "timing-refeicao", label: "C/ Refei√ß√£o" },
            treino: { class: "timing-treino", label: "Treino" },
            dormir: { class: "timing-dormir", label: "Dormir" }
        };

        // Fases actualizadas para 2025-2026
        const PHASES = [
            { id: 1, name: "Base", start: "2025-12-01", end: "2026-01-24", color: "#3b82f6" },
            { id: 2, name: "Espec√≠fica", start: "2026-01-25", end: "2026-03-07", color: "#8b5cf6" },
            { id: 3, name: "Peak", start: "2026-03-08", end: "2026-04-04", color: "#f59e0b" },
            { id: 4, name: "Taper", start: "2026-04-05", end: "2026-04-26", color: "#10b981" }
        ];

        // ============ HELPERS ============
        const formatDateKey = (d) => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
        
        const getPhase = (date) => {
            const d = new Date(date);
            for (const p of PHASES) {
                if (d >= new Date(p.start) && d <= new Date(p.end + "T23:59:59")) return p;
            }
            return null;
        };

        const getWeekNumber = (date) => {
            const d = new Date(date);
            const diffTime = d - PLAN_START;
            if (diffTime < 0) return 0;
            return Math.floor(diffTime / (7 * 24 * 60 * 60 * 1000)) + 1;
        };

        const getDaysToRace = () => {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const race = new Date(RACE_DATE);
            race.setHours(0, 0, 0, 0);
            const diff = race - today;
            return Math.max(0, Math.ceil(diff / (1000 * 60 * 60 * 24)));
        };

        const getSupplementsForDay = (date, supplementBlocks) => {
            const d = new Date(date);
            const dow = d.getDay();
            const phase = getPhase(date);
            const isTaper = phase?.id === 4;
            
            const result = {};
            Object.entries(supplementBlocks).forEach(([key, block]) => {
                const items = block.items.filter(item => {
                    if (item.taperOnly && !isTaper) return false;
                    if (item.days && !item.days.includes(dow)) {
                        if (item.id === 'beterraba' && isTaper) return true;
                        return false;
                    }
                    return true;
                });
                if (items.length > 0) {
                    result[key] = { ...block, items };
                }
            });
            return result;
        };

        const getTotalSupplements = (blocks) => Object.values(blocks).reduce((sum, b) => sum + b.items.length, 0);

        // ============ APP ============
        function App() {
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [activeTab, setActiveTab] = useState('tracker');
            const [checked, setChecked] = useState(() => {
                try {
                    const saved = localStorage.getItem('maratonaSupp_checked');
                    return saved ? JSON.parse(saved) : {};
                } catch (e) {
                    console.error('Erro ao carregar dados:', e);
                    return {};
                }
            });
            const [supplementBlocks, setSupplementBlocks] = useState(() => {
                try {
                    const saved = localStorage.getItem('maratonaSupp_config');
                    return saved ? JSON.parse(saved) : DEFAULT_SUPPLEMENTS;
                } catch (e) {
                    return DEFAULT_SUPPLEMENTS;
                }
            });

            // Guardar automaticamente
            useEffect(() => {
                try {
                    localStorage.setItem('maratonaSupp_checked', JSON.stringify(checked));
                } catch (e) {
                    console.error('Erro ao guardar:', e);
                }
            }, [checked]);

            useEffect(() => {
                try {
                    localStorage.setItem('maratonaSupp_config', JSON.stringify(supplementBlocks));
                } catch (e) {
                    console.error('Erro ao guardar config:', e);
                }
            }, [supplementBlocks]);

            const dateKey = formatDateKey(selectedDate);
            const phase = getPhase(selectedDate);
            const week = getWeekNumber(selectedDate);
            const daysToRace = getDaysToRace();
            const blocks = getSupplementsForDay(selectedDate, supplementBlocks);
            const dayData = checked[dateKey] || {};
            
            const total = getTotalSupplements(blocks);
            const done = Object.values(blocks).reduce((sum, b) => 
                sum + b.items.filter(i => dayData[i.id]).length, 0);
            const pct = total > 0 ? Math.round((done / total) * 100) : 0;

            const toggle = (id) => {
                setChecked(prev => ({
                    ...prev,
                    [dateKey]: { ...prev[dateKey], [id]: !prev[dateKey]?.[id] }
                }));
            };

            const changeDay = (delta) => {
                const d = new Date(selectedDate);
                d.setDate(d.getDate() + delta);
                setSelectedDate(d);
            };

            const updateSupplement = (blockKey, itemId, field, value) => {
                setSupplementBlocks(prev => ({
                    ...prev,
                    [blockKey]: {
                        ...prev[blockKey],
                        items: prev[blockKey].items.map(item => 
                            item.id === itemId ? { ...item, [field]: value } : item
                        )
                    }
                }));
            };

            const resetToDefaults = () => {
                if (confirm('Repor todas as dosagens para os valores originais?')) {
                    setSupplementBlocks(DEFAULT_SUPPLEMENTS);
                }
            };

            const dow = selectedDate.getDay();
            const dayNames = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
            const dayEmojis = ['üèÉ', 'üí™', 'üèä', '‚ö°', 'üí™', 'üèä', 'üò¥'];

            return (
                <div style={{ maxWidth: 500, margin: '0 auto', padding: 16 }}>
                    
                    {/* Header */}
                    <div style={{ 
                        background: 'linear-gradient(135deg, #1e293b 0%, #334155 100%)',
                        borderRadius: 16, 
                        padding: 16,
                        marginBottom: 12
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
                            <div>
                                <div style={{ fontSize: 11, color: '#94a3b8', marginBottom: 2 }}>üèÉ Maratona Londres 2026</div>
                                <div style={{ fontSize: 11, color: '#64748b' }}>26 Abril 2026</div>
                                <div style={{ fontSize: 28, fontWeight: 700, color: '#f59e0b', marginTop: 4 }}>
                                    {daysToRace} <span style={{ fontSize: 14, fontWeight: 400, color: '#94a3b8' }}>dias</span>
                                </div>
                            </div>
                            <div style={{ textAlign: 'right' }}>
                                {week > 0 ? (
                                    <>
                                        <div style={{ fontSize: 24, fontWeight: 700, color: '#3b82f6' }}>
                                            Sem {week}
                                        </div>
                                        <div style={{ fontSize: 11, color: '#64748b' }}>de 21 semanas</div>
                                    </>
                                ) : (
                                    <div style={{ fontSize: 12, color: '#64748b' }}>Pr√©-plano</div>
                                )}
                                {phase && (
                                    <div style={{ 
                                        fontSize: 11, 
                                        padding: '3px 10px', 
                                        borderRadius: 99,
                                        background: phase.color,
                                        display: 'inline-block',
                                        marginTop: 6,
                                        fontWeight: 500
                                    }}>
                                        {phase.name}
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Progress bar */}
                        {activeTab === 'tracker' && (
                            <div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 12, marginBottom: 4 }}>
                                    <span style={{ color: '#94a3b8' }}>Progresso hoje</span>
                                    <span style={{ fontWeight: 600, color: pct === 100 ? '#10b981' : '#f1f5f9' }}>
                                        {done}/{total} ({pct}%)
                                    </span>
                                </div>
                                <div style={{ height: 8, background: '#1e293b', borderRadius: 4, overflow: 'hidden' }}>
                                    <div style={{ 
                                        height: '100%', 
                                        width: `${pct}%`, 
                                        background: pct === 100 ? '#10b981' : 'linear-gradient(90deg, #3b82f6, #8b5cf6)',
                                        borderRadius: 4,
                                        transition: 'width 0.3s'
                                    }} />
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Tabs */}
                    <div style={{ display: 'flex', gap: 8, marginBottom: 12 }}>
                        <button
                            onClick={() => setActiveTab('tracker')}
                            className={activeTab === 'tracker' ? 'tab-active' : ''}
                            style={{
                                flex: 1, padding: '10px', background: '#1e293b',
                                border: '1px solid #334155', borderRadius: 10,
                                color: '#94a3b8', fontSize: 13, fontWeight: 500, cursor: 'pointer'
                            }}
                        >
                            üìÖ Tracker
                        </button>
                        <button
                            onClick={() => setActiveTab('settings')}
                            className={activeTab === 'settings' ? 'tab-active' : ''}
                            style={{
                                flex: 1, padding: '10px', background: '#1e293b',
                                border: '1px solid #334155', borderRadius: 10,
                                color: '#94a3b8', fontSize: 13, fontWeight: 500, cursor: 'pointer'
                            }}
                        >
                            ‚öôÔ∏è Dosagens
                        </button>
                    </div>

                    {activeTab === 'tracker' ? (
                        <TrackerView 
                            selectedDate={selectedDate}
                            changeDay={changeDay}
                            setSelectedDate={setSelectedDate}
                            blocks={blocks}
                            dayData={dayData}
                            toggle={toggle}
                            checked={checked}
                            supplementBlocks={supplementBlocks}
                            dateKey={dateKey}
                            setChecked={setChecked}
                            phase={phase}
                            dayEmojis={dayEmojis}
                            dayNames={dayNames}
                            dow={dow}
                        />
                    ) : (
                        <SettingsView 
                            supplementBlocks={supplementBlocks}
                            updateSupplement={updateSupplement}
                            resetToDefaults={resetToDefaults}
                        />
                    )}

                    {/* Footer stats */}
                    <div style={{
                        marginTop: 16, padding: '12px 16px', background: '#1e293b',
                        borderRadius: 12, display: 'flex', justifyContent: 'space-around', textAlign: 'center'
                    }}>
                        <StatBox label="üî• Streak" value={calculateStreak(checked, supplementBlocks)} color="#f59e0b" />
                        <div style={{ width: 1, background: '#334155' }} />
                        <StatBox label="‚úì Perfeitos" value={calculatePerfectDays(checked, supplementBlocks)} color="#3b82f6" />
                        <div style={{ width: 1, background: '#334155' }} />
                        <StatBox label="üìä Ader√™ncia" value={calculateAdherence(checked, supplementBlocks) + '%'} color="#10b981" />
                    </div>

                    {/* Legend */}
                    <div style={{
                        marginTop: 12, padding: '10px 14px', background: '#1e293b',
                        borderRadius: 10, fontSize: 10, color: '#64748b'
                    }}>
                        <div style={{ marginBottom: 6, fontWeight: 600, color: '#94a3b8' }}>Legenda Timing:</div>
                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8 }}>
                            <span className="timing-tag timing-jejum">Jejum</span>
                            <span className="timing-tag timing-refeicao">C/ Refei√ß√£o</span>
                            <span className="timing-tag timing-treino">Treino</span>
                            <span className="timing-tag timing-dormir">Dormir</span>
                        </div>
                    </div>

                    {/* Storage info */}
                    <div style={{
                        marginTop: 8, padding: '8px 12px', background: 'rgba(16, 185, 129, 0.1)',
                        borderRadius: 8, fontSize: 10, color: '#64748b', textAlign: 'center'
                    }}>
                        üíæ Dados guardados automaticamente no browser
                    </div>
                </div>
            );
        }

        // ============ TRACKER VIEW ============
        function TrackerView({ selectedDate, changeDay, setSelectedDate, blocks, dayData, toggle, checked, supplementBlocks, dateKey, setChecked, phase, dayEmojis, dayNames, dow }) {
            return (
                <>
                    {/* Date navigation */}
                    <div style={{ 
                        display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                        background: '#1e293b', borderRadius: 12, padding: '8px 12px', marginBottom: 12
                    }}>
                        <button onClick={() => changeDay(-1)} style={{ 
                            background: 'none', border: 'none', color: '#94a3b8', 
                            fontSize: 20, cursor: 'pointer', padding: '4px 12px'
                        }}>‚Üê</button>
                        
                        <div style={{ textAlign: 'center' }}>
                            <div style={{ fontSize: 13, color: '#94a3b8' }}>
                                {dayEmojis[dow]} {dayNames[dow]}
                            </div>
                            <div style={{ fontSize: 15, fontWeight: 600 }}>
                                {selectedDate.toLocaleDateString('pt-PT', { day: 'numeric', month: 'short', year: 'numeric' })}
                            </div>
                        </div>
                        
                        <button onClick={() => changeDay(1)} style={{ 
                            background: 'none', border: 'none', color: '#94a3b8', 
                            fontSize: 20, cursor: 'pointer', padding: '4px 12px'
                        }}>‚Üí</button>
                    </div>

                    {/* Mini calendar week */}
                    <div style={{ display: 'flex', gap: 4, marginBottom: 16, justifyContent: 'center' }}>
                        {[-3, -2, -1, 0, 1, 2, 3].map(offset => {
                            const d = new Date(selectedDate);
                            d.setDate(d.getDate() + offset);
                            const dk = formatDateKey(d);
                            const dayChecked = checked[dk] || {};
                            const dayBlocks = getSupplementsForDay(d, supplementBlocks);
                            const dayTotal = getTotalSupplements(dayBlocks);
                            const dayDone = Object.values(dayBlocks).reduce((sum, b) => 
                                sum + b.items.filter(i => dayChecked[i.id]).length, 0);
                            const dayPct = dayTotal > 0 ? Math.round((dayDone / dayTotal) * 100) : 0;
                            const isSelected = offset === 0;
                            const isToday = formatDateKey(new Date()) === dk;
                            
                            return (
                                <button
                                    key={offset}
                                    onClick={() => setSelectedDate(new Date(d))}
                                    style={{
                                        width: 40, height: 48,
                                        border: isSelected ? '2px solid #3b82f6' : '1px solid #334155',
                                        borderRadius: 8,
                                        background: isSelected ? '#1e3a5f' : '#1e293b',
                                        cursor: 'pointer',
                                        display: 'flex', flexDirection: 'column',
                                        alignItems: 'center', justifyContent: 'center',
                                        position: 'relative'
                                    }}
                                >
                                    <span style={{ fontSize: 10, color: '#64748b' }}>
                                        {['D','S','T','Q','Q','S','S'][d.getDay()]}
                                    </span>
                                    <span style={{ 
                                        fontSize: 14, fontWeight: isToday ? 700 : 500,
                                        color: isToday ? '#3b82f6' : '#f1f5f9'
                                    }}>
                                        {d.getDate()}
                                    </span>
                                    {dayPct > 0 && (
                                        <div style={{
                                            position: 'absolute', bottom: 3,
                                            width: 6, height: 6, borderRadius: '50%',
                                            background: dayPct === 100 ? '#10b981' : dayPct >= 50 ? '#f59e0b' : '#ef4444'
                                        }} />
                                    )}
                                </button>
                            );
                        })}
                    </div>

                    {/* Supplement blocks */}
                    <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                        {Object.entries(blocks).map(([key, block]) => {
                            const blockDone = block.items.filter(i => dayData[i.id]).length;
                            const blockTotal = block.items.length;
                            const allDone = blockDone === blockTotal;

                            return (
                                <div key={key} style={{ 
                                    background: block.bgColor, borderRadius: 12,
                                    border: `1px solid ${block.color}33`, overflow: 'hidden'
                                }}>
                                    <div style={{ 
                                        padding: '10px 14px', display: 'flex',
                                        justifyContent: 'space-between', alignItems: 'center',
                                        borderBottom: `1px solid ${block.color}22`
                                    }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                                            <span style={{ fontSize: 18 }}>{block.emoji}</span>
                                            <div>
                                                <div style={{ fontWeight: 600, fontSize: 14 }}>{block.name}</div>
                                                <div style={{ fontSize: 11, color: '#94a3b8' }}>{block.time}</div>
                                            </div>
                                        </div>
                                        <div style={{ fontSize: 12, fontWeight: 600, color: allDone ? '#10b981' : block.color }}>
                                            {allDone ? '‚úì' : `${blockDone}/${blockTotal}`}
                                        </div>
                                    </div>

                                    <div style={{ padding: '6px 8px' }}>
                                        {block.items.map((item, idx) => {
                                            const isChecked = dayData[item.id];
                                            const timingStyle = TIMING_STYLES[item.timing] || TIMING_STYLES.refeicao;
                                            
                                            return (
                                                <button
                                                    key={item.id}
                                                    onClick={() => toggle(item.id)}
                                                    style={{
                                                        width: '100%', display: 'flex', alignItems: 'center',
                                                        gap: 10, padding: '10px 10px',
                                                        background: isChecked ? 'rgba(16, 185, 129, 0.2)' : 'transparent',
                                                        border: 'none', borderRadius: 8, cursor: 'pointer',
                                                        transition: 'all 0.15s',
                                                        marginBottom: idx < block.items.length - 1 ? 4 : 0
                                                    }}
                                                >
                                                    <div style={{
                                                        width: 24, height: 24, borderRadius: 6,
                                                        border: isChecked ? 'none' : `2px solid ${block.color}`,
                                                        background: isChecked ? '#10b981' : 'transparent',
                                                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                                                        fontSize: 14, color: '#fff', flexShrink: 0
                                                    }}>
                                                        {isChecked && '‚úì'}
                                                    </div>
                                                    <div style={{ flex: 1, textAlign: 'left', opacity: isChecked ? 0.5 : 1 }}>
                                                        <div style={{ display: 'flex', alignItems: 'center', flexWrap: 'wrap' }}>
                                                            <span style={{ 
                                                                fontSize: 13, color: '#f1f5f9', fontWeight: 500,
                                                                textDecoration: isChecked ? 'line-through' : 'none'
                                                            }}>
                                                                {item.name}
                                                            </span>
                                                            {item.caps && (
                                                                <span style={{ fontSize: 11, color: '#64748b', marginLeft: 6 }}>
                                                                    ({item.caps} caps)
                                                                </span>
                                                            )}
                                                            <span className={`timing-tag ${timingStyle.class}`}>
                                                                {timingStyle.label}
                                                            </span>
                                                        </div>
                                                        <div style={{ fontSize: 10, color: '#64748b', marginTop: 2 }}>
                                                            {item.notes}
                                                        </div>
                                                    </div>
                                                    <span style={{ fontSize: 11, color: '#94a3b8', opacity: isChecked ? 0.5 : 1, fontWeight: 500 }}>
                                                        {item.dose}
                                                    </span>
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Quick actions */}
                    <div style={{ display: 'flex', gap: 8, marginTop: 16 }}>
                        <button
                            onClick={() => {
                                const allIds = {};
                                Object.values(blocks).forEach(b => b.items.forEach(i => allIds[i.id] = true));
                                setChecked(prev => ({ ...prev, [dateKey]: allIds }));
                            }}
                            style={{
                                flex: 1, padding: '12px', background: '#1e293b',
                                border: '1px solid #334155', borderRadius: 10,
                                color: '#10b981', fontSize: 13, fontWeight: 500, cursor: 'pointer'
                            }}
                        >
                            ‚úì Marcar Todos
                        </button>
                        <button
                            onClick={() => setChecked(prev => ({ ...prev, [dateKey]: {} }))}
                            style={{
                                flex: 1, padding: '12px', background: '#1e293b',
                                border: '1px solid #334155', borderRadius: 10,
                                color: '#ef4444', fontSize: 13, fontWeight: 500, cursor: 'pointer'
                            }}
                        >
                            ‚úï Limpar Dia
                        </button>
                    </div>

                    {phase?.id === 4 && (
                        <div style={{
                            marginTop: 12, padding: '10px 14px',
                            background: 'rgba(16, 185, 129, 0.15)', borderRadius: 10,
                            border: '1px solid rgba(16, 185, 129, 0.3)',
                            fontSize: 12, color: '#94a3b8'
                        }}>
                            <strong style={{ color: '#10b981' }}>‚ö° Fase Taper</strong>
                            <span> ‚Äî Cereja √Åcida 2x/dia + Beterraba di√°ria</span>
                        </div>
                    )}
                </>
            );
        }

        // ============ SETTINGS VIEW ============
        function SettingsView({ supplementBlocks, updateSupplement, resetToDefaults }) {
            return (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
                        <h2 style={{ fontSize: 16, fontWeight: 600 }}>‚öôÔ∏è Configurar Dosagens</h2>
                        <button
                            onClick={resetToDefaults}
                            style={{
                                padding: '6px 12px', background: '#1e293b',
                                border: '1px solid #334155', borderRadius: 8,
                                color: '#f59e0b', fontSize: 11, cursor: 'pointer'
                            }}
                        >
                            ‚Ü∫ Repor
                        </button>
                    </div>

                    <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                        {Object.entries(supplementBlocks).map(([blockKey, block]) => (
                            <div key={blockKey} style={{ 
                                background: block.bgColor, borderRadius: 12,
                                border: `1px solid ${block.color}33`, overflow: 'hidden'
                            }}>
                                <div style={{ 
                                    padding: '10px 14px', display: 'flex', alignItems: 'center', gap: 8,
                                    borderBottom: `1px solid ${block.color}22`
                                }}>
                                    <span style={{ fontSize: 16 }}>{block.emoji}</span>
                                    <span style={{ fontWeight: 600, fontSize: 14 }}>{block.name}</span>
                                    <span style={{ fontSize: 11, color: '#64748b' }}>({block.time})</span>
                                </div>

                                <div style={{ padding: '8px' }}>
                                    {block.items.map((item, idx) => (
                                        <div 
                                            key={item.id}
                                            style={{
                                                padding: '10px', background: 'rgba(0,0,0,0.2)',
                                                borderRadius: 8, marginBottom: idx < block.items.length - 1 ? 8 : 0
                                            }}
                                        >
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 8 }}>
                                                <span style={{ fontSize: 13, fontWeight: 600 }}>{item.name}</span>
                                                <select
                                                    value={item.timing || 'refeicao'}
                                                    onChange={(e) => updateSupplement(blockKey, item.id, 'timing', e.target.value)}
                                                    style={{
                                                        padding: '4px 8px', background: '#1e293b',
                                                        border: '1px solid #334155', borderRadius: 6,
                                                        color: '#f1f5f9', fontSize: 11
                                                    }}
                                                >
                                                    <option value="jejum">Em Jejum</option>
                                                    <option value="refeicao">C/ Refei√ß√£o</option>
                                                    <option value="treino">Treino</option>
                                                    <option value="dormir">Antes Dormir</option>
                                                </select>
                                            </div>
                                            
                                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 60px', gap: 8, marginBottom: 8 }}>
                                                <input
                                                    type="text"
                                                    value={item.dose}
                                                    onChange={(e) => updateSupplement(blockKey, item.id, 'dose', e.target.value)}
                                                    placeholder="Dose"
                                                    style={{
                                                        padding: '6px 10px', background: '#1e293b',
                                                        border: '1px solid #334155', borderRadius: 6,
                                                        color: '#f1f5f9', fontSize: 12
                                                    }}
                                                />
                                                <input
                                                    type="text"
                                                    value={item.caps === null ? '‚Äî' : item.caps}
                                                    onChange={(e) => {
                                                        const val = e.target.value;
                                                        updateSupplement(blockKey, item.id, 'caps', 
                                                            val === '‚Äî' || val === '' ? null : parseInt(val) || val
                                                        );
                                                    }}
                                                    placeholder="Caps"
                                                    style={{
                                                        padding: '6px 10px', background: '#1e293b',
                                                        border: '1px solid #334155', borderRadius: 6,
                                                        color: '#f1f5f9', fontSize: 12, textAlign: 'center'
                                                    }}
                                                />
                                            </div>
                                            
                                            <input
                                                type="text"
                                                value={item.notes}
                                                onChange={(e) => updateSupplement(blockKey, item.id, 'notes', e.target.value)}
                                                placeholder="Notas (ex: Em jejum, antes do treino...)"
                                                style={{
                                                    width: '100%', padding: '6px 10px', background: '#1e293b',
                                                    border: '1px solid #334155', borderRadius: 6,
                                                    color: '#94a3b8', fontSize: 11
                                                }}
                                            />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>

                    <div style={{
                        marginTop: 16, padding: '12px',
                        background: 'rgba(59, 130, 246, 0.1)', borderRadius: 10,
                        border: '1px solid rgba(59, 130, 246, 0.2)',
                        fontSize: 11, color: '#94a3b8'
                    }}>
                        üí° <strong>Dica:</strong> Todas as altera√ß√µes s√£o guardadas automaticamente. Use "‚Äî" para suplementos em p√≥.
                    </div>
                </div>
            );
        }

        // ============ STAT BOX ============
        function StatBox({ label, value, color }) {
            return (
                <div>
                    <div style={{ fontSize: 18, fontWeight: 700, color }}>{value}</div>
                    <div style={{ fontSize: 10, color: '#64748b' }}>{label}</div>
                </div>
            );
        }

        // ============ STAT CALCULATORS ============
        function calculateStreak(checked, supplementBlocks) {
            let streak = 0;
            const d = new Date();
            while (true) {
                const dk = formatDateKey(d);
                const dayBlocks = getSupplementsForDay(d, supplementBlocks);
                const dayTotal = getTotalSupplements(dayBlocks);
                const dayChecked = checked[dk] || {};
                const dayDone = Object.values(dayBlocks).reduce((sum, b) => 
                    sum + b.items.filter(i => dayChecked[i.id]).length, 0);
                if (dayTotal > 0 && dayDone === dayTotal) {
                    streak++;
                    d.setDate(d.getDate() - 1);
                } else break;
            }
            return streak;
        }

        function calculatePerfectDays(checked, supplementBlocks) {
            let perfect = 0;
            const today = new Date();
            const d = new Date(PLAN_START);
            while (d <= today) {
                const dk = formatDateKey(d);
                const dayBlocks = getSupplementsForDay(d, supplementBlocks);
                const dayTotal = getTotalSupplements(dayBlocks);
                const dayChecked = checked[dk] || {};
                const dayDone = Object.values(dayBlocks).reduce((sum, b) => 
                    sum + b.items.filter(i => dayChecked[i.id]).length, 0);
                if (dayTotal > 0 && dayDone === dayTotal) perfect++;
                d.setDate(d.getDate() + 1);
            }
            return perfect;
        }

        function calculateAdherence(checked, supplementBlocks) {
            let totalT = 0, takenT = 0;
            const today = new Date();
            const d = new Date(PLAN_START);
            while (d <= today) {
                const dk = formatDateKey(d);
                const dayBlocks = getSupplementsForDay(d, supplementBlocks);
                const dayTotal = getTotalSupplements(dayBlocks);
                totalT += dayTotal;
                const dayChecked = checked[dk] || {};
                Object.values(dayBlocks).forEach(b => 
                    b.items.forEach(i => { if (dayChecked[i.id]) takenT++; }));
                d.setDate(d.getDate() + 1);
            }
            return totalT > 0 ? Math.round((takenT / totalT) * 100) : 0;
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
